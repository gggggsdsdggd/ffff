-- Shared Script Label (Loaded via loadstring)
-- Edit this:
local MAIN_USERID = 5081423380  -- Your main account's UserId (number)

-- Default ALTS table (used if _G.ALTS is not defined)
local ALTS = _G.ALTS or {
    987654321,  -- Alt 1 UserId
    111222333,  -- Alt 2 UserId
    -- Add more alt UserIds here, e.g., 456789123,
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Check if local player is allowed (main or in ALTS)
local isAllowed = LocalPlayer.UserId == MAIN_USERID or table.find(ALTS, LocalPlayer.UserId)
if not isAllowed then
    warn("Your UserId (" .. LocalPlayer.UserId .. ") is not in ALTS or MAIN_USERID. Script disabled.")
    return
end

-- Mark this player as a script user
local scriptUserFlag = Instance.new("BoolValue")
scriptUserFlag.Name = "ScriptUser"
scriptUserFlag.Value = true
scriptUserFlag.Parent = LocalPlayer

-- Print local player's UserId
print("Your UserId is: " .. LocalPlayer.UserId)

-- Label function: Add BillboardGui for main user (alts) or alts (main)
local function addLabel(player)
    -- Main account: Create "Alt User" labels for players in ALTS
    if LocalPlayer.UserId == MAIN_USERID and table.find(ALTS, player.UserId) and player.Character and player.Character:FindFirstChild("Head") then
        local head = player.Character.Head
        if head:FindFirstChild("AltUserLabel") then return end
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "AltUserLabel"
        billboard.Adornee = head
        billboard.Size = UDim2.new(4, 0, 1, 0) -- Scale units for fixed size on zoom
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true

        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = "Alt User"
        textLabel.TextColor3 = Color3.fromRGB(255, 255, 255) -- White
        textLabel.TextScaled = false
        textLabel.TextSize = 24 -- Normal size
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.Parent = billboard

        billboard.Parent = head
        print("Added label to alt: " .. player.Name .. " (" .. player.UserId .. ")")
    -- Non-main script users in ALTS: Create "Owner" label for main user
    elseif LocalPlayer.UserId ~= MAIN_USERID and player.UserId == MAIN_USERID and player.Character and player.Character:FindFirstChild("Head") then
        local head = player.Character.Head
        if head:FindFirstChild("OwnerLabel") then return end
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "OwnerLabel"
        billboard.Adornee = head
        billboard.Size = UDim2.new(4, 0, 1, 0) -- Scale units for fixed size on zoom
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true

        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = "Owner"
        textLabel.TextColor3 = Color3.fromRGB(255, 255, 255) -- White
        textLabel.TextScaled = false
        textLabel.TextSize = 24 -- Normal size
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.Parent = billboard

        billboard.Parent = head
        print("Added label to owner: " .. player.Name .. " (" .. player.UserId .. ")")
    end
end

-- Remove label
local function removeLabel(player)
    if player.Character and player.Character:FindFirstChild("Head") then
        local head = player.Character.Head
        if LocalPlayer.UserId == MAIN_USERID and head:FindFirstChild("AltUserLabel") then
            head.AltUserLabel:Destroy()
            print("Removed alt label from " .. player.Name .. " (" .. player.UserId .. ")")
        elseif LocalPlayer.UserId ~= MAIN_USERID and head:FindFirstChild("OwnerLabel") then
            head.OwnerLabel:Destroy()
            print("Removed owner label from " .. player.Name .. " (" .. player.UserId .. ")")
        end
    end
end

-- Monitor players for labels and print UserIds for main
local function updateLabels()
    for _, player in ipairs(Players:GetPlayers()) do
        -- Print UserIds of alts to main account's console
        if LocalPlayer.UserId == MAIN_USERID and table.find(ALTS, player.UserId) then
            print("Detected alt user: " .. player.Name .. " (" .. player.UserId .. ")")
        end
        -- Apply labels
        if (LocalPlayer.UserId == MAIN_USERID and table.find(ALTS, player.UserId)) or
           (LocalPlayer.UserId ~= MAIN_USERID and player.UserId == MAIN_USERID) then
            addLabel(player)
        else
            removeLabel(player)
        end
    end
end

-- Run label updates on heartbeat and when players join/leave
RunService.Heartbeat:Connect(updateLabels)
Players.PlayerAdded:Connect(updateLabels)
Players.PlayerRemoving:Connect(updateLabels)

-- Handle character respawn
LocalPlayer.CharacterAdded:Connect(function()
    wait(1) -- Wait for character to load
    -- Re-apply script user flag
    local newFlag = Instance.new("BoolValue")
    newFlag.Name = "ScriptUser"
    newFlag.Value = true
    newFlag.Parent = LocalPlayer
    updateLabels()
end)

-- Initial label update
updateLabels()
print("Shared Script Label loaded! Main UserId: " .. MAIN_USERID .. ". Main sees 'Alt User' on alts in ALTS; alts in ALTS see 'Owner' on main.")
